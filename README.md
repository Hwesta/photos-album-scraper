# Readme

## Problem

Export of Google Photos albums sucks. Google Takeout only does photos. The [API](https://developers.google.com/photos/library/reference/rest/v1/albums/) only returns name and cover information, and no part of the API returns "enrichments" like text and locations, with [no plans to add that](https://issuetracker.google.com/issues/129050144). The page returned from a HTTP request or to the browser is unreadable JS garbage, with all the functions minified and the content in obtuse data strings.

## Goal

Write a script that can export a Google Photos album into human-readable HTML, CSS and Javascript that I can host anywhere.

I couldn't find any projects that did this already (but please let me know if I missed any).

Project left un-licensed (and thus copyrighted) until it actually does something.

## Notes

* Test album: https://photos.app.goo.gl/gcrtqKqLaxkz2jYcA

    * aka https://photos.google.com/share/AF1QipOsyTRCCkFhI8kRqZiQ8K5ICY_836mUn6wQNmiPRZUAxaGLGL4pMqylMVe04RNbDA?key=MktDaHBHQlNHSzFFdFo4WEVGZjRfbE9HUEFpRDNn
    * album ID `ABqBtt-Uyj3E7zHBYXRi3sZIu4tBJBwSbWMUNvxrEqtdFex-v4w7iY1La45w57rVt4QwGQjKW6fr`
    * image IDs
        * `ABqBtt-SUE55wIz-mgbWvFbiaR4xOXim8vg4B-6_G4xGYEB9qrMNATuYcBJIWGSLu3mrjy-OGMuje5Q4MwmuHVJ3divYtnJuaA`
        * `ABqBtt9yxrUmrvqghqdD4a5TGTDXze20qxX8ex9vtvVSSZGbVni4cSJarOjJRq_08LEn5oUSKDByvyn-jz7end7vGfJfm_SeyA`

* Longer album: https://photos.google.com/share/AF1QipPJW0gqaSFeTccPW6j2VdRm_5AG5RMzTtF14m433rPdZetpBLzmfQf4k-mdUrxULQ?key=Mk9QZ2tXY2h3WnhvMjBycUVYcldXR1JNMnY0ZTd3

Can't correlate info from API with info parsed from saved page, no IDs overlap

3 image sizes?
* smallest = "baseURL"
* medium = "baseUrl" + "=d" also missing some metadata like GPS, shows as generated by Picasa
    * baseURL needs a suffix applied - "=d" for download (original? all exif except location metadata)
    * could specify "=w##-h##" to get that, still not original metadata
* largest = "productURL" -> go and download item from menu. Original? App can't open, only user?
* see also https://developers.google.com/photos/library/guides/access-media-items#base-urls

`AF_initDataCallback(<stuff here>)` seems to be a protobuf

Another idea: breakpoint on something, see what the actual code is doing


### protobuf docs

overall structure

```
[
    null
    [list of images],
    "",
    [album info including sharing?],
    [list of enrichments]
]
```

list of images format
```
[
    "AF1QipOlQgoYJGjKaFOMHJkYqQVH4zxkn9brxgwXHhq2", # Not the ID
    [
        "https://lh3.googleusercontent.com/LsrFFBNSwatmdiOo1HkWmLm3Rp0rDFxvtisUx51cnTX7R-N5s-OsWsk0b4_KTckar_6wAHgdDjSWV4CZlsTYIPtr7FkHqRVEMaV3OMFBR-3DPh3OAwD7zueJL_K9cjWRK8QBavWbRQo",  # baseURl
        4608, # w
        3456, # h
        null,
        [],
        null,
        [],
        null,
        null,
        [
            13155507
        ]
    ],
    1654022822000, # date may 31 11:47 photo taken
    "TOt7ob2rr6UBovGSirT8orZJDaM",
    -25200000, # tz offset
    1654554455008, # june 6 15:30 - added to album??
    [
        "AF1QipMN6zXOdB5TdqYqMm_qJ4Q0699P" # same in both images
    ],
    [ # same in both images
        [
            2
        ],
        [
            31,
            false,
            true
        ],
        [
            36,
            false,
            true
        ],
        [
            8
        ],
        [
            21
        ],
        [
            19
        ],
        [
            22
        ]
    ],
    2,
    null,
    null,
    null,
    [],
    null,
    19222, # same in both images
    [],
    { # related to location?
        "101428965": [
            0,
            "vdh9cohf070000000000004k"  # this value changes when reordered
        ]
    }
],
```

* `99218341` = possibly stable key for location & text info
* `101428965` = ordering info? always has `[0, <similar string>]`

## Ref

### photos api

* https://pypi.org/project/gphotos-sync/ ref for how used?
* https://github.com/gilesknap/gphotos-sync/tree/master/gphotos
* https://developers.google.com/photos/library/guides/authentication-authorization
* https://developers.google.com/photos/library/guides/get-started
* https://developers.google.com/photos/library/guides/list#listing-album-contents
* https://developers.google.com/photos/library/reference/rest/v1/albums
* https://stackoverflow.com/questions/52281453/google-photos-api-with-filter-to-get-photos-with-album-information

### auth

* https://google-auth.readthedocs.io/en/latest/user-guide.html
* https://oauthlib.readthedocs.io/en/latest/oauth2/clients/client.html
* https://github.com/requests/requests-oauthlib
* https://requests-oauthlib.readthedocs.io/en/latest/examples/google.html
